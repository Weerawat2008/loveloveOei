<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏£‡∏±‡∏Å ‚Äî ‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö üíï</title>
  <style>
    /* Pastel / romantic theme */
    :root{--bg1:#fff0f6;--bg2:#fff7fb;--card:#ffffffcc;--accent:#ff7ab6;--muted:#7d6a7d}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans', 'Helvetica Neue', Arial}
    body{background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#2b1f2b;display:flex;align-items:center;justify-content:center;padding:20px}
    .app{width:1100px;max-width:100%;display:grid;grid-template-columns:380px 1fr;gap:20px}
    .panel{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 8px 30px rgba(120,70,100,0.08)}
    h2{margin:0 0 10px 0;font-size:18px;color:#3b233b}
    .muted{color:var(--muted);font-size:13px}

    /* left editor */
    .items{display:flex;flex-direction:column;gap:10px;max-height:440px;overflow:auto;padding-right:6px}
    .item{display:flex;gap:8px;align-items:center}
    .item input[type=text]{flex:1;padding:8px;border-radius:10px;border:1px solid rgba(120,70,100,0.06);background:transparent;color:inherit}
    .item input[type=color]{width:44px;height:36px;border-radius:10px;border:0;padding:0}
    .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    button{background:var(--accent);border:0;color:white;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    .small{font-size:13px}

    /* stage */
    .stage{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px}
    .wheel-wrap{position:relative}
    canvas{background:transparent;border-radius:12px;touch-action:none;display:block}
    .pointer{position:absolute;left:50%;transform:translateX(-50%);top:-14px;width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:26px solid #fff1f6;filter:drop-shadow(0 6px 12px rgba(150,70,120,0.12))}
    .result{margin-top:8px;padding:10px 14px;border-radius:12px;background:linear-gradient(90deg,#fff6fb,#fff8f9);min-height:44px;display:flex;align-items:center;gap:8px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.6)}

    /* hearts animation */
    .hearts{position:fixed;left:0;right:0;top:0;bottom:0;pointer-events:none;overflow:hidden}
    .heart{position:absolute;width:18px;height:18px;background:radial-gradient(circle at 30% 35%, #fff, transparent 30%), linear-gradient(135deg,#ff9ccf,#ff70b8);transform:rotate(-45deg);border-radius:5px 5px 0 0;opacity:0.9;animation:floatUp 6s linear infinite}
    .heart:before,.heart:after{content:'';position:absolute;background:inherit;border-radius:50%;}
    .heart:before{width:18px;height:18px;left:-9px;top:0}
    .heart:after{width:18px;height:18px;left:0;top:-9px}
    @keyframes floatUp{0%{transform:translateY(110vh) scale(0.6) rotate(-45deg);opacity:0}10%{opacity:1}100%{transform:translateY(-20vh) scale(1.05) rotate(-25deg);opacity:0}}

    /* intro modal */
    .overlay{position:fixed;left:0;right:0;top:0;bottom:0;background:linear-gradient(180deg,rgba(255,245,250,0.95),rgba(255,249,251,0.92));display:flex;align-items:center;justify-content:center;z-index:40}
    .intro{max-width:760px;width:94%;background:linear-gradient(180deg,#ffffff,#fff7fb);border-radius:16px;padding:26px;box-shadow:0 20px 60px rgba(120,60,100,0.12);text-align:center}
    .intro h1{margin:0;font-size:28px;color:#5a2f56}
    .intro p{margin:10px 0 18px 0;color:#6b4a6b}
    .start-btn{background:#ff6fa8;color:white;padding:12px 20px;border-radius:12px;font-size:16px;border:0;cursor:pointer}

    /* responsive */
    @media(max-width:980px){.app{grid-template-columns:1fr;padding:12px}.panel{padding:14px}}
  </style>
</head>
<body>
  <div class="hearts" id="hearts"></div>

  <div class="app">
    <div class="panel">
      <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á ‚Äî (‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</h2>
      <div class="muted">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ/‡∏•‡∏ö ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ß‡∏á‡∏•‡πâ‡∏≠</div>

      <div class="items" id="items"></div>

      <div style="display:flex;gap:8px;margin-top:12px">
        <input id="newText" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏ä‡πà‡∏ô 'üíã ‡∏´‡∏≠‡∏° 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á'" style="flex:1;padding:8px;border-radius:10px;border:1px solid rgba(120,70,100,0.06)" />
        <button id="addNew">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      </div>

      <div class="controls">
        <button id="shuffle">‡∏™‡∏∏‡πà‡∏°‡∏™‡∏µ</button>
        <button id="reset">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
        <button id="saveLocal">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
        <button id="loadLocal">‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
      </div>

      <div style="margin-top:12px" class="small muted">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ä‡∏£‡πå:</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="shareUrl" type="text" readonly style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(120,70,100,0.06);background:transparent;color:inherit" />
        <button id="copyLink">Copy</button>
      </div>

    </div>

    <div class="panel stage">
      <h2 style="width:100%;text-align:center">‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</h2>
      <div class="wheel-wrap">
        <div class="pointer" id="pointer"></div>
        <canvas id="wheel" width="720" height="720"></canvas>
      </div>

      <div style="display:flex;gap:12px;align-items:center;justify-content:center;width:100%">
        <button id="spin">Spin ‚ú®</button>
        <button id="fast">Spin ‡πÄ‡∏£‡πá‡∏ß</button>
        <button id="stop">‡∏´‡∏¢‡∏∏‡∏î</button>
      </div>

      <div class="result" id="result">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
    </div>
  </div>

  <!-- intro overlay -->
  <div class="overlay" id="intro">
    <div class="intro">
      <h1>‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å üíï</h1>
      <p>‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏∞‡∏´‡∏°‡∏∏‡∏ô‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏£‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á? ‡∏•‡∏≠‡∏á‡∏Å‡∏î <strong>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢</strong> ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏ö‡∏≤ ‡πÜ ‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞</p>
      <div style="display:flex;gap:10px;justify-content:center;align-items:center">
        <label style="font-size:14px;color:#6b4a6b">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏•‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ): <input id="audioFile" type="file" accept="audio/*"/></label>
      </div>
      <div style="margin-top:14px"><button class="start-btn" id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢</button></div>
    </div>
  </div>

<script>
// ---------- defaults ----------
const defaultItems = [
  {text:'üíã ‡∏´‡∏≠‡∏° 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á', color:'#FFB6D5'},
  {text:'üç∞ ‡∏û‡∏≤‡πÑ‡∏õ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏ô‡∏°', color:'#FFD8A8'},
  {text:'üéÅ ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç', color:'#CFE9B9'},
  {text:'üé¨ ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô', color:'#9ED9FF'},
  {text:'ü´∂ ‡∏Å‡∏≠‡∏î‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô', color:'#E7C7FF'},
  {text:'‚òï ‡∏ä‡∏á‡∏Å‡∏≤‡πÅ‡∏ü‡πÉ‡∏´‡πâ', color:'#FFE0F0'},
  {text:'üíå ‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏±‡∏Å', color:'#FFDFE6'},
  {text:'üö∂‚Äç‚ôÇÔ∏è ‡πÄ‡∏î‡∏ó‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô', color:'#D8F7F2'}
];

// ---------- state ----------
let items = loadFromUrl() || loadFromLocal() || JSON.parse(JSON.stringify(defaultItems));
let canvas = document.getElementById('wheel');
let ctx = canvas.getContext('2d');
let cw = canvas.width, ch = canvas.height, radius = cw/2 - 20;
let center = {x:cw/2, y:ch/2};
let rotation = 0;
let isSpinning = false; let angularVelocity = 0; let spinAnimId = null; let easing = 0.995;
let resultEl = document.getElementById('result');

// ---------- draw ----------
function drawWheel(){
  ctx.clearRect(0,0,cw,ch);
  const n = items.length; if(n===0) return; const arc = Math.PI*2 / n;
  for(let i=0;i<n;i++){
    const start = rotation + i*arc; const end = start + arc;
    ctx.beginPath(); ctx.moveTo(center.x, center.y); ctx.arc(center.x, center.y, radius, start, end); ctx.closePath(); ctx.fillStyle = items[i].color || pickColor(i); ctx.fill();
    // text
    ctx.save(); ctx.translate(center.x, center.y); const angle = start + arc/2; ctx.rotate(angle);
    ctx.textAlign = 'right'; ctx.fillStyle = '#2b1f2b'; ctx.font = 'bold 22px sans-serif';
    const lines = wrapText(items[i].text, 14);
    for(let li=0;li<lines.length;li++){ ctx.fillText(lines[li], radius - 18, 8 + li*22); }
    ctx.restore();
  }
  // center circle
  ctx.beginPath(); ctx.arc(center.x, center.y, 60, 0, Math.PI*2); ctx.fillStyle = '#fff'; ctx.fill();
  ctx.beginPath(); ctx.arc(center.x, center.y, 38, 0, Math.PI*2); ctx.fillStyle = '#ffeef6'; ctx.fill();
}
function wrapText(str, maxChars){ const words = str.split(' '); const lines = []; let cur = ''; for(const w of words){ if((cur + ' ' + w).trim().length <= maxChars) cur = (cur + ' ' + w).trim(); else { lines.push(cur); cur = w; } } if(cur) lines.push(cur); return lines; }
function pickColor(i){ const palette = ['#FFB6D5','#FFD8A8','#CFE9B9','#9ED9FF','#E7C7FF','#FFE0F0','#FFDFE6','#D8F7F2','#FBD3FF','#FFEFD6']; return palette[i % palette.length]; }

// ---------- spin ----------
function spinOnce(power=1){ if(items.length===0) return; if(isSpinning) return; isSpinning = true; angularVelocity = (Math.random()*0.8 + 1.2) * power; animate(); }
function animate(){ spinAnimId = requestAnimationFrame(animate); rotation += angularVelocity * 0.02; angularVelocity *= easing; drawWheel(); if(Math.abs(angularVelocity) < 0.002){ cancelAnimationFrame(spinAnimId); isSpinning = false; angularVelocity = 0; const n = items.length; const arc = Math.PI*2 / n; const pointerAngle = -Math.PI/2; const normalized = ( (pointerAngle - rotation) % (Math.PI*2) + Math.PI*2) % (Math.PI*2); let idx = Math.floor(normalized / arc); idx = (idx + n) % n; showResult(idx); } }
function forceStop(){ angularVelocity = 0.0001; }
function showResult(idx){ const it = items[idx]; resultEl.innerHTML = `üéâ ‡πÑ‡∏î‡πâ: <strong>${escapeHtml(it?.text || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£')}</strong>`; const prev = it.color; it.color = '#fff8a8'; drawWheel(); setTimeout(()=>{ it.color = prev; drawWheel(); }, 1200); }
function escapeHtml(s){ return s.replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// ---------- UI ----------
function renderItemsUI(){ const container = document.getElementById('items'); container.innerHTML = ''; items.forEach((it,i)=>{ const div = document.createElement('div'); div.className='item'; const inp = document.createElement('input'); inp.type='text'; inp.value = it.text; inp.addEventListener('input', e=>{ items[i].text = e.target.value; saveLocal(); updateShareUrl(); drawWheel(); }); const color = document.createElement('input'); color.type='color'; color.value = it.color||pickColor(i); color.addEventListener('input', e=>{ items[i].color = e.target.value; saveLocal(); drawWheel(); updateShareUrl(); }); const del = document.createElement('button'); del.textContent='‡∏•‡∏ö'; del.style.background='#ff9aa2'; del.addEventListener('click', ()=>{ items.splice(i,1); renderItemsUI(); saveLocal(); updateShareUrl(); drawWheel(); }); div.appendChild(inp); div.appendChild(color); div.appendChild(del); container.appendChild(div); }); }

document.getElementById('addNew').addEventListener('click', ()=>{ const v = document.getElementById('newText').value.trim(); if(!v) return; items.push({text:v,color:pickColor(items.length)}); document.getElementById('newText').value=''; renderItemsUI(); saveLocal(); updateShareUrl(); drawWheel(); });
document.getElementById('shuffle').addEventListener('click', ()=>{ items.forEach((it,i)=>it.color=pickColor(Math.floor(Math.random()*20))); renderItemsUI(); saveLocal(); updateShareUrl(); drawWheel(); });
document.getElementById('reset').addEventListener('click', ()=>{ items = JSON.parse(JSON.stringify(defaultItems)); renderItemsUI(); saveLocal(); updateShareUrl(); drawWheel(); });
document.getElementById('saveLocal').addEventListener('click', ()=>{ saveToLocalStorage(); const b=document.getElementById('saveLocal'); b.textContent='Saved ‚úÖ'; setTimeout(()=>b.textContent='‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á',1200); });

// spin buttons
document.getElementById('spin').addEventListener('click', ()=>spinOnce(1));
document.getElementById('fast').addEventListener('click', ()=>spinOnce(1.8));
document.getElementById('stop').addEventListener('click', ()=>forceStop());

document.getElementById('copyLink').addEventListener('click', ()=>{ const inp = document.getElementById('shareUrl'); inp.select(); document.execCommand('copy'); const b=document.getElementById('copyLink'); b.textContent='‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ'; setTimeout(()=>b.textContent='Copy',1200); });

// ---------- persistence & share ----------
function saveToLocalStorage(){ localStorage.setItem('spin_wheel_data', JSON.stringify(items)); }
function saveLocal(){ saveToLocalStorage(); }
function updateShareUrl(){ try{ const encoded = encodeURIComponent(btoa(JSON.stringify(items))); const share = `${location.origin}${location.pathname}?data=${encoded}`; document.getElementById('shareUrl').value = share; history.replaceState(null, '', `?data=${encoded}`); }catch(e){console.error(e);} }
function loadFromUrl(){ try{ const p = new URLSearchParams(location.search); if(p.has('data')){ const raw = p.get('data'); const json = atob(decodeURIComponent(raw)); const parsed = JSON.parse(json); return parsed; } }catch(e){console.warn('loadFromUrl failed', e);} return null; }
function loadFromLocal(){ try{ const l = localStorage.getItem('spin_wheel_data'); if(l) return JSON.parse(l); }catch(e){} return null; }

// ---------- download PNG ----------
function downloadPNG(){ const tmpCanvas = document.createElement('canvas'); tmpCanvas.width = 2048; tmpCanvas.height = 2048; const tctx = tmpCanvas.getContext('2d'); const scale = tmpCanvas.width / cw; tctx.fillStyle = '#fff'; tctx.fillRect(0,0,tmpCanvas.width,tmpCanvas.height); tctx.save(); tctx.translate(tmpCanvas.width/2, tmpCanvas.height/2); tctx.scale(scale, scale); const n = items.length; const arc = Math.PI*2 / n; for(let i=0;i<n;i++){ const start = rotation + i*arc; const end = start + arc; tctx.beginPath(); tctx.moveTo(0,0); tctx.arc(0,0, radius, start, end); tctx.closePath(); tctx.fillStyle = items[i].color||pickColor(i); tctx.fill(); tctx.save(); tctx.rotate(start + arc/2); tctx.textAlign='right'; tctx.fillStyle='#2b1f2b'; tctx.font = 'bold 22px sans-serif'; const lines = wrapText(items[i].text, 18); for(let li=0;li<lines.length;li++) tctx.fillText(lines[li], radius - 18, 8 + li*22); tctx.restore(); }
 tctx.restore(); const url = tmpCanvas.toDataURL('image/png'); const a = document.createElement('a'); a.href = url; a.download = 'spin-wheel.png'; a.click(); }

// ---------- hearts generator ----------
function spawnHearts(){ const container = document.getElementById('hearts'); for(let i=0;i<12;i++){ const h = document.createElement('div'); h.className='heart'; h.style.left = (Math.random()*100)+'%'; h.style.width = (10+Math.random()*28)+'px'; h.style.height = h.style.width; h.style.animationDelay = (Math.random()*5)+'s'; h.style.opacity = (0.6+Math.random()*0.4); container.appendChild(h); setTimeout(()=>h.remove(), 12000); } }
setInterval(spawnHearts, 3000);
spawnHearts();

// ---------- intro & audio ----------
let audioBuffer = null; let audioCtx = null; let bgmNode = null; let bgGain = null; let userAudioFile = null;
const intro = document.getElementById('intro');
const startBtn = document.getElementById('startBtn');
const audioFileInput = document.getElementById('audioFile');

audioFileInput.addEventListener('change', (e)=>{ userAudioFile = e.target.files[0] || null; });

startBtn.addEventListener('click', async ()=>{
  // start gentle generated music (WebAudio) or use uploaded file
  if(userAudioFile){ const url = URL.createObjectURL(userAudioFile); const a = new Audio(url); a.loop = true; a.volume = 0.25; a.play(); window.__bgAudio = a; }
  else { startGeneratedAmbient(); }
  intro.style.display='none';
});

function startGeneratedAmbient(){ try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); bgGain = audioCtx.createGain(); bgGain.gain.value = 0.12; bgGain.connect(audioCtx.destination);
  // simple sequence of soft tones using oscillators
  const notes = [440, 523.25, 659.25, 783.99]; // A4, C5, E5, G5
  let i=0; function playStep(){ const o = audioCtx.createOscillator(); const s = audioCtx.createGain(); o.type='sine'; o.frequency.value = notes[i%notes.length]; s.gain.value = 0.0001; o.connect(s); s.connect(bgGain); o.start(); s.gain.linearRampToValueAtTime(0.06, audioCtx.currentTime + 0.2); s.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 2.6); o.stop(audioCtx.currentTime + 2.8); i++; setTimeout(playStep, 700); }
  playStep(); }catch(e){console.error('audio failed', e);} }

// ---------- init ----------
function init(){ renderItemsUI(); drawWheel(); updateShareUrl(); }
init();

// paste to load JSON quick
window.addEventListener('paste', (e)=>{ const text = (e.clipboardData||window.clipboardData).getData('text'); if(text && text.trim().startsWith('[')){ try{ const parsed = JSON.parse(text); if(Array.isArray(parsed)){ items = parsed; renderItemsUI(); drawWheel(); updateShareUrl(); }}catch(err){} } });

</script>
</body>
</html>
